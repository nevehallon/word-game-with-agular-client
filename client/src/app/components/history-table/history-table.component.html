<div
    #container
    class="container mat-elevation-z8"
>
    <table
        #table
        mat-table
        [dataSource]="dataSource"
        multiTemplateDataRows
    >

        <!-- Moves Column -->
        <ng-container matColumnDef="move">
            <th
                [ngStyle]="{'color': 'black'}"
                mat-header-cell
                *matHeaderCellDef
            > Moves </th>
            <td
                #td
                mat-cell
                *matCellDef="let element"
                [class]="element?.isAI ? 'opponent' : 'player'"
            >
                <div class="move-column-text">

                    {{element?.word | lowercase}}
                    <span [ngClass]="{'bold': element?.points}">
                        {{element?.points ? '[+' + element?.points + ']': element?.skip?.isSwap ? "Swap"
                        :
                        "Pass"}}
                    </span>
                </div>
            </td>
            <td
                [class]="lastEntry?.isAI ? 'opponent' : 'player'"
                mat-footer-cell
                *matFooterCellDef
            >
                <div class="move-column-text">

                    {{lastEntry?.word | lowercase}}
                    <span [ngClass]="{'bold': lastEntry?.points}">
                        {{lastEntry?.points ? '[+' + lastEntry?.points + ']': lastEntry?.skip?.isSwap ? "Swap"
                        : firstTurn && !gameOver ? 'Start of Game' : gameOver ? '' : "Pass"}}
                    </span>
                </div>
            </td>
        </ng-container>

        <!-- Opponent Column -->
        <ng-container matColumnDef="opponent">
            <th
                class="opponent"
                mat-header-cell
                *matHeaderCellDef
            > Opponent </th>
            <td
                class="opponent"
                mat-cell
                *matCellDef="let element"
                [ngClass]="{'bold': element?.points && element?.isAI}"
            > {{element?.score?.computerScore}} </td>
            <td
                class="opponent bold"
                mat-footer-cell
                *matFooterCellDef
            > {{lastEntry?.score?.computerScore || 0}} </td>
        </ng-container>

        <!-- Player Column -->
        <ng-container matColumnDef="player">
            <th
                class="player"
                mat-header-cell
                *matHeaderCellDef
            > Player </th>
            <td
                class="player"
                mat-cell
                *matCellDef="let element"
                [ngClass]="{'bold': element?.points && !element?.isAI}"
            > {{element?.score?.playerScore}} </td>
            <td
                class="player bold"
                mat-footer-cell
                *matFooterCellDef
            > {{lastEntry?.score?.playerScore || 0}} </td>
        </ng-container>


        <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->
        <ng-container matColumnDef="expandedDetail">
            <td
                #tCell
                mat-cell
                *matCellDef="let element"
                [attr.colspan]="displayedColumns.length"
            >
                <div
                    class="element-detail mat-content"
                    (touchstart)="swipe($event, 'start', element?.definitions.length || 1)"
                    (touchend)="swipe($event, 'end')"
                    [@detailExpand]="element === expandedElement ? scrollInView(container, tCell) : 'collapsed'"
                >
                    <mat-tab-group
                        class="element-diagram"
                        color="accent"
                        backgroundColor="primary"
                        [disablePagination]="true"
                        mat-align-tabs="center"
                        [(selectedIndex)]="selectedTab"
                    >
                        <mat-tab
                            *ngFor="let word of element?.definitions;index as i; count as count;"
                            [ngStyle]="{'min-width': 100 / count + '%'}"
                        >
                            <ng-template mat-tab-label>
                                <span>
                                    {{word.headword || element?.word.split(", ")[i] | lowercase}}
                                </span>
                            </ng-template>

                            <app-audio-btn [word]="word.headword || element?.word.split(', ')[i] | lowercase">
                            </app-audio-btn>

                            <div
                                class="bold pronunciation"
                                *ngIf="word.pronunciation && word.pronunciation.trim()"
                            >
                                [<span [innerHTML]="word.pronunciation.trim()"></span>]
                            </div>
                            <div *ngFor="let wordDef of word.definitions | filterDefs; index as ii; last as last">
                                <div
                                    *ngIf="ii < 10"
                                    class="defContainer"
                                >
                                    <div class="moreDetails">
                                        {{ii + 1}})

                                        <span
                                            class="part"
                                            [innerHTML]="wordDef.part | lowercase"
                                        ></span>
                                    </div>
                                    <div class="defText bold">

                                        - <span [innerHTML]="wordDef.txt"></span>
                                    </div>

                                </div>
                            </div>
                            <div
                                class="wordOrigin"
                                [innerHTML]="'* '+origin.txt"
                                *ngFor="let origin of word?.origin"
                            ></div>
                            <div
                                class="notFound center-align"
                                *ngIf="!(word.definitions | filterDefs).length"
                            >
                                Sorry, we couldn't find the definition for the word "{{word.headword ||
                                element?.word.split(', ')[i] | lowercase}}", but you might have better luck if you check
                                <a
                                    class="bold player"
                                    target="_blank"
                                    [href]="'https://www.google.com/search?q=define+' + (word.headword || element?.word.split(', ')[i]) |lowercase"
                                >
                                    here
                                </a>
                            </div>
                        </mat-tab>
                    </mat-tab-group>
                </div>
            </td>
        </ng-container>

        <tr
            mat-header-row
            *matHeaderRowDef="displayedColumns; sticky: true"
        ></tr>
        <tr
            mat-row
            *matRowDef="let row; columns: displayedColumns; dataIndex as i"
            [hidden]="i === dataSource.length - 1"
            class="element-row"
            [class.expanded-row]="expandedElement === row"
            [class.expandable]="row.points"
            (click)="expandedElement = expandedElement === row ? null : row"
            (click)="selectedTab = 0"
        ></tr>
        <tr
            mat-footer-row
            *matFooterRowDef="displayedColumns; sticky: true"
            class="element-row"
            [class.expanded-row]="expandedElement === lastEntry"
            [class.expandable]="lastEntry?.points"
            (click)="expandedElement = expandedElement === lastEntry ? null : lastEntry"
            (click)="selectedTab = 0"
        ></tr>
        <tr
            mat-row
            *matRowDef="let row; columns: ['expandedDetail']; when: isExpansionDetailRow"
            class="detail-row"
        ></tr>
    </table>
</div>